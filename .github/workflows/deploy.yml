# Plik: .github/workflows/deploy.yml

name: Deploy Frontend na Vercel (Hobby)

on:
  push:
    branches:
      - main # Wdrażaj, gdy zmiany zostaną wypchnięte do gałęzi 'main'
  pull_request:
    types: [opened, synchronize] # Twórz podglądy dla Pull Requestów

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      # 1. Ustawienie środowiska
      - name: Ustawienie Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      # 2. Instalacja Vercel CLI
      - name: Instalacja Vercel CLI
        run: npm install -g vercel@latest

      # 3. Instalacja zależności projektu
      - name: Instalacja zależności
        run: npm install

      # 4. Proces Budowania (Build)
      # Vercel Actions automatycznie wykryje polecenia, ale dla pewności można dodać
      - name: Budowanie projektu
        run: vercel build # Vercel CLI buduje projekt lokalnie

      # 5. Wdrożenie na Vercel
      - name: Deploy na Vercel
        # Jeśli akcja jest wywołana przez PR, to jest to Preview Deployment.
        # W przeciwnym razie, jeśli to push do main, to jest to Production Deployment.
        run: vercel deploy --prebuilt --token ${{ secrets.VERCEL_TOKEN }}
        env:
          # VERCEL_TOKEN jest wymagany do autoryzacji
          VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
          # Te zmienne informują Vercel CLI, na jaki projekt i konto ma wdrożyć:
          VERCEL_ORG_ID: team_C4AZcVdFc11AMhFZJYIfMpJT
          VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}
        with:
          # Opcja --prod jest dodawana TYLKO przy push do gałęzi main
          prod: ${{ github.ref == 'refs/heads/main' }}
